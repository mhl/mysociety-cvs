# -*- coding: iso-8859-1 -*-
"""
    MoinMoin mstheme theme

    @copyright: (c) 2003-2004 by Nir Soffer, Thomas Waldmann
    @license: GNU GPL, see COPYING for details.
"""

from MoinMoin.theme import ThemeBase
import urllib

class Theme(ThemeBase):

    name = "mstheme"

# Public functions #####################################################

    def img_url(self, img):
        """ Generate an image href

        @param img: the image filename
        @rtype: string
        @return: the image href
        """
        return "%s/%s/img/%s" % (self.cfg.url_prefix, self.name, img)
 
    def html_stylesheets(self, d):
        return """<link rel="stylesheet" href="/global.css" type="text/css" media="screen">""" 
        #+ ThemeBase.html_stylesheets(self, d)

    def header(self, d, **kw):
        """ Assemble wiki header
        
        @param d: parameter dictionary
        @rtype: unicode
        @return: page header html
        """
        nav_menu = urllib.urlopen("http://www.mysociety.org/menu.html").read()
        html = [
            # Pre header custom html
            self.emit_custom_html(self.cfg.page_header1),

            u"""
            <div id="top">
<div id="masthead"><a href="/"><img border="0" src="/mslogo.gif" alt="mySociety.org"></a></div>
</div>

<div class="page-body">

    %s 

    <div class="moin">""" % nav_menu,

 
            # Header
            u'<div id="header">',
            # self.logo(),
            self.searchform(d),
#            self.username(d),
#            self.trail(d),
#            self.navibar(d),
            #u'<hr id="pageline">',
#            u'<div id="pageline"><hr style="display:none;"></div>',
#            self.msg(d),
#            self.editbar(d),
#            u'</div>',
            
            # Post header custom html (not recommended)
            self.emit_custom_html(self.cfg.page_header2),
            
            # Start of page
            self.startPage(),
            self.title(d),
        ]
        return u'\n'.join(html)

    def footer(self, d, **keywords):
        """ Assemble wiki footer
        
        @param d: parameter dictionary
        @keyword ...:...
        @rtype: unicode
        @return: page footer html
        """
        page = d['page']
        html = [
            # End of page
            #self.pageinfo(page),
            self.endPage(),
            
            # Pre footer custom html (not recommended!)
            self.emit_custom_html(self.cfg.page_footer1),
            
            # Footer
            #self.trail(d),
            #self.navibar(d),
            u'<div id="footer">',
            self.msg(d),
            self.editbar(d),
            #self.credits(d),
            #self.showversion(d, **keywords),
            u'</div>',
            self.username(d),

            u'''</div>''', # class="moin"
            
            # Post footer custom html
            self.emit_custom_html(self.cfg.page_footer2),
            ]
        return u'\n'.join(html)

        
def execute(request):
    """
    Generate and return a theme object
        
    @param request: the request object
    @rtype: MoinTheme
    @return: Theme object
    """
    return Theme(request)

