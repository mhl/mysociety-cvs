#! /usr/bin/perl -w
# compactsearchdb. Compacts the Xapian search database
#
# $Id: compactsearchdb,v 1.5 2009-10-26 13:29:09 matthew Exp $

use strict;

use FindBin;
use File::Path;
use lib "$FindBin::Bin/../../perllib";

use mySociety::Config;
mySociety::Config::set_file("$FindBin::Bin/../conf/general");

my $xapian = mySociety::Config::get('XAPIANDB');

rmtree("$xapian-compacted");
system("xapian-compact $xapian/ $xapian-compacted/ >/dev/null");
rmtree("$xapian-previous");
rename $xapian, "$xapian-previous";
rename "$xapian-compacted", $xapian;
rename "$xapian-previous/twfy-lastupdated", "$xapian/twfy-lastupdated";

