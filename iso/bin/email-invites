#!/usr/bin/python
#
# email-invites:
# Send out invites
#
# Copyright (c) 2009 UK Citizens Online Democracy. All rights reserved.
# Email: matthew@mysociety.org; WWW: http://www.mysociety.org/
#
# $Id: email-invites,v 1.14 2009-10-07 21:34:54 duncan Exp $
#

import sys
sys.path.extend((sys.path[0]+"/../pylib", sys.path[0]+"/../../pylib"))

import optparse

import mysociety.config
mysociety.config.set_file(sys.path[0]+"/../conf/general")

import page
import storage

parser = optparse.OptionParser()
parser.set_usage('''
./email-invites [OPTIONS]

Sends out various sorts of email invites to people in the database who are waiting for them.
''')
parser.add_option('--friend', action='store_true', dest="friend", help='Send invites of friends type', default=False)
parser.add_option('--signup', action='store_true', dest="signup", help='Send invites of signups type', default=False)
parser.add_option('--limit', type='int', dest="limit", help='Limit to number of invites to send per type', default=1)
parser.add_option('--email', type='string', dest="email", help='Restrict to only sending invites to this email', default=None)
parser.add_option('--debug', action='store_true', dest="debug", help='Print some debugging.', default=False)
(options, args) = parser.parse_args()

if not options.friend and not options.signup:
    print "Please specify at least --friend or --signup"
    sys.exit(1)




invites = []

if options.friend:
    invites.extend(
        storage.get_new_invites(
            email=options.email,
            limit=options.limit,
            source='friend')
        )

if options.signup:
    invites.extend(
        storage.get_new_invites(
            email=options.email,
            limit=options.limit,
            source='web')
        )

for invite in invites:
    page.email_invite(invite)


